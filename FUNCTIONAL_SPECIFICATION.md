# FUNCTIONAL SPECIFICATION DOCUMENT
## User Management & Tasks API

**Version:** 1.0.0
**Last Updated:** 2025-11-03
**Document Purpose:** System requirements and functional specification for test automation

---

## TABLE OF CONTENTS

1. [System Overview](#1-system-overview)
2. [Code Structure & Paths](#2-code-structure--paths)
3. [Architecture & Technology Stack](#3-architecture--technology-stack)
4. [Integration Architecture](#4-integration-architecture)
5. [Database Specification](#5-database-specification)
6. [API Endpoints Specification](#6-api-endpoints-specification)
7. [Business Logic & Rules](#7-business-logic--rules)
8. [Functional Requirements](#8-functional-requirements)
9. [Performance Requirements](#9-performance-requirements)
10. [Security Requirements](#10-security-requirements)
11. [Database Backup, Restore & DR Requirements](#11-database-backup-restore--dr-requirements)
12. [Error Handling & Status Codes](#12-error-handling--status-codes)
13. [Data Validation Rules](#13-data-validation-rules)
14. [OpenAPI Specification](#14-openapi-specification)
15. [Known Limitations](#15-known-limitations)

---

## 1. SYSTEM OVERVIEW

### 1.1 Purpose
This API provides a RESTful interface for managing users and their associated tasks/todos. It is designed to demonstrate modern API development practices and serves as a platform for automated API testing.

### 1.2 Core Capabilities
- **User Management**: Complete CRUD (Create, Read, Update, Delete) operations for user entities
- **Task Management**: Full lifecycle management of tasks associated with users
- **Data Validation**: Comprehensive input validation using Pydantic framework
- **Pagination**: Support for paginated list queries
- **Database Reset**: Utility endpoint for resetting to initial state (testing purposes)

### 1.3 System Boundaries
- **In Scope**: User management, task management, basic validation, RESTful operations
- **Out of Scope**: Authentication/Authorization, persistent storage, real-time notifications, file uploads, caching

### 1.4 Integration Points
- **Frontend**: Designed to be consumed by web/mobile applications via HTTP/JSON
- **Test Reports API**: Separate service running on port 5001 (out of scope for this specification)
- **Documentation**: Auto-generated Swagger UI and ReDoc interfaces

---

## 2. CODE STRUCTURE & PATHS

### 2.1 Project Root Directory
```
Base Path: /Users/qrish/api/
```

### 2.2 File Structure
```
/Users/qrish/api/
├── main.py                    # Main API application - All User & Task endpoints
├── report_api.py             # Separate Test Reports API (port 5001)
├── models.py                 # Database models (in-memory storage)
├── schemas.py                # Pydantic validation schemas
├── openapi.json              # OpenAPI 3.1.0 specification
├── requirements.txt          # Python dependencies
├── start.sh                  # Server start script
├── stop.sh                   # Server stop script
├── api.log                   # Runtime logs (generated)
├── api.pid                   # Process ID file (generated)
├── FUNCTIONAL_SPECIFICATION.md  # This document
└── autoagent/                # Virtual environment directory
```

### 2.3 Key File Details

#### **main.py** (253 lines)
- **Path**: `/Users/qrish/api/main.py`
- **Function**: Primary FastAPI application
- **Contents**:
  - Lines 1-11: Imports and dependencies
  - Lines 8-11: FastAPI app initialization
  - Lines 14-26: Query parameter validation middleware
  - Lines 28-86: User CRUD endpoints (6 endpoints)
  - Lines 88-129: Database reset endpoint
  - Lines 133-252: Task CRUD endpoints (6 endpoints)

#### **models.py** (40 lines)
- **Path**: `/Users/qrish/api/models.py`
- **Function**: In-memory database storage
- **Contents**:
  - Lines 2-5: users_db list with 2 seed users
  - Lines 7-39: tasks_db list with 3 seed tasks

#### **schemas.py** (40 lines)
- **Path**: `/Users/qrish/api/schemas.py`
- **Function**: Pydantic data validation models
- **Contents**:
  - Lines 1-3: Imports
  - Lines 5-17: User schemas (UserBase, UserCreate, UserUpdate, User)
  - Lines 20-39: Task schemas (TaskBase, TaskCreate, TaskUpdate, Task)

#### **openapi.json** (852 lines)
- **Path**: `/Users/qrish/api/openapi.json`
- **Function**: OpenAPI 3.1.0 specification
- **Generated**: Auto-generated by FastAPI from code annotations
- **Access URL**: `http://localhost:8000/openapi.json`

---

## 3. ARCHITECTURE & TECHNOLOGY STACK

### 3.1 Technology Components

| Component | Technology | Version | Purpose |
|-----------|------------|---------|---------|
| **Framework** | FastAPI | Latest | Web framework for building APIs |
| **Server** | Uvicorn | Latest | ASGI server for running FastAPI |
| **Language** | Python | 3.13 | Programming language |
| **Validation** | Pydantic | Latest | Data validation and serialization |
| **Email Validation** | email-validator | Latest | Email format validation |
| **Database** | In-Memory (Python List) | N/A | Temporary data storage |
| **Documentation** | OpenAPI/Swagger | 3.1.0 | API documentation |

### 3.2 Architecture Pattern
**Style**: Layered Architecture with 3 tiers

1. **Presentation Layer** (main.py - Route Handlers)
   - Receives HTTP requests
   - Validates URL parameters
   - Returns HTTP responses

2. **Business Logic Layer** (main.py - Endpoint Functions)
   - Implements business rules
   - Validates business constraints
   - Manages data operations

3. **Data Layer** (models.py)
   - In-memory storage using Python lists
   - Direct list manipulation (append, remove, iterate)

### 3.3 Request/Response Flow
```
Client Request (HTTP/JSON)
    ↓
FastAPI Router
    ↓
Query Parameter Middleware (if GET /users)
    ↓
Pydantic Request Validation
    ↓
Business Logic (Endpoint Function)
    ↓
Database Operation (List manipulation)
    ↓
Pydantic Response Serialization
    ↓
HTTP Response (JSON)
```

### 3.4 Server Configuration

**Main API (User & Task Management)**
- **Host**: localhost (127.0.0.1)
- **Port**: 8000
- **Base URL**: `http://localhost:8000`
- **Protocol**: HTTP (no HTTPS)
- **Process Management**:
  - Start: `./start.sh`
  - Stop: `./stop.sh`
  - PID file: `api.pid`
  - Logs: `api.log`

**Documentation Endpoints**
- **Swagger UI**: `http://localhost:8000/docs`
- **ReDoc**: `http://localhost:8000/redoc`
- **OpenAPI JSON**: `http://localhost:8000/openapi.json`

---

## 4. INTEGRATION ARCHITECTURE

### 4.1 Integration Overview

**Current State**: This API is a **standalone service** with no active upstream or downstream integrations.

**Integration Capability**: The API is designed to be consumed by frontend applications (web/mobile) and can be extended to integrate with other backend services.

**Integration Pattern**: RESTful HTTP/JSON over synchronous request-response

### 4.2 System Integration Diagram

```
┌─────────────────────────────────────────────────────────────┐
│                    UPSTREAM SYSTEMS                          │
│                  (Consumers of this API)                     │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │   Web App    │  │  Mobile App  │  │  External    │     │
│  │  (React/Vue) │  │ (iOS/Android)│  │  Services    │     │
│  │              │  │              │  │              │     │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘     │
│         │                 │                 │              │
│         └─────────────────┼─────────────────┘              │
│                           │                                │
└───────────────────────────┼────────────────────────────────┘
                            │
                    HTTP/JSON (Port 8000)
                            │
┌───────────────────────────▼────────────────────────────────┐
│                                                             │
│              USER MANAGEMENT & TASKS API                    │
│              (This Service - Port 8000)                     │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Endpoints: /users, /tasks, /reset-db                │  │
│  │  Database: In-Memory (users_db, tasks_db)            │  │
│  │  Validation: Pydantic                                │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
└───────────────────────────┬────────────────────────────────┘
                            │
                    (No downstream integrations currently)
                            │
┌───────────────────────────▼────────────────────────────────┐
│                  DOWNSTREAM SYSTEMS                         │
│              (Services consumed by this API)                │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ❌ None Currently Implemented                               │
│                                                              │
│  Potential Future Integrations:                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │  Email       │  │  Notification│  │  Analytics   │     │
│  │  Service     │  │  Service     │  │  Service     │     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

### 4.3 Upstream Systems (API Consumers)

#### 4.3.1 Frontend Applications

**Integration Type**: HTTP REST Client → This API
**Protocol**: HTTP/1.1
**Format**: JSON
**Authentication**: None (public endpoints)

**Supported Clients**:
1. **Web Applications** (React, Vue, Angular)
   - Base URL: `http://localhost:8000`
   - CORS: ❌ Not configured (same-origin only)
   - Expected behavior: Must be hosted on same domain

2. **Mobile Applications** (iOS, Android, React Native)
   - Access: Direct HTTP calls
   - CORS: Not applicable for native apps
   - Expected behavior: Full API access

3. **External Services** (Third-party integrations)
   - Access: HTTP REST calls
   - Authentication: ❌ Not implemented
   - Expected behavior: Public access (security risk)

#### 4.3.2 Client Integration Requirements

**Required Headers**:
```
Content-Type: application/json
Accept: application/json
```

**Optional Headers** (for future use):
```
Authorization: Bearer <token>        (Not implemented)
X-Request-ID: <correlation-id>       (Not implemented)
X-Client-Version: <version>          (Not implemented)
```

#### 4.3.3 Client Expected Behaviors

**Normal Operation**:
- Client sends valid JSON request
- API validates request (Pydantic)
- API processes business logic
- API returns JSON response with appropriate status code
- Client handles response

**Error Scenarios - Client Side**:

| Scenario | Client Behavior | API Response | Client Action |
|----------|-----------------|--------------|---------------|
| Invalid JSON | Malformed request body | 422 Unprocessable Entity | Fix request format |
| Missing required field | Incomplete request | 422 with field details | Add missing field |
| Invalid email format | Bad email string | 422 with validation error | Correct email format |
| Duplicate email | Email exists in DB | 400 Bad Request | Use different email |
| Resource not found | GET non-existent ID | 404 Not Found | Handle gracefully |
| Network timeout | No response | Connection timeout | Retry with backoff |
| Server unavailable | Connection refused | Connection error | Retry or failover |

**Retry Policy Recommendations** (for clients):
```
- Idempotent operations (GET): Retry immediately
- Non-idempotent (POST): Retry with exponential backoff
- Max retries: 3
- Backoff: 1s, 2s, 4s
- Timeout: 30 seconds
```

#### 4.3.4 Client Integration Failure Scenarios

**Scenario 1: API Unavailable**
- **Cause**: Server down, network issue
- **Client Behavior**: Connection error/timeout
- **Client Action**:
  - Display user-friendly error message
  - Cache data locally if possible
  - Retry with exponential backoff
  - Fallback to cached data
  - Alert user when service restored

**Scenario 2: Partial Response**
- **Cause**: Network interruption mid-response
- **Client Behavior**: Incomplete JSON
- **Client Action**:
  - Detect incomplete response
  - Retry request
  - Log error for monitoring

**Scenario 3: Slow Response**
- **Cause**: High load, network latency
- **Client Behavior**: Request timeout
- **Client Action**:
  - Set reasonable timeout (30s recommended)
  - Show loading indicator
  - Allow user to cancel
  - Retry with backoff

**Scenario 4: Rate Limiting** (if implemented)
- **Cause**: Too many requests
- **Client Behavior**: 429 Too Many Requests
- **Client Action**:
  - Read Retry-After header
  - Wait specified duration
  - Implement client-side throttling

### 4.4 Downstream Systems (Services Consumed by This API)

#### 4.4.1 Current State

**Status**: ❌ No downstream integrations implemented

This API currently operates as a **leaf service** with no dependencies on external systems.

#### 4.4.2 Potential Future Downstream Integrations

The following downstream services could be integrated in future versions:

**1. Authentication Service**
- **Purpose**: Validate user credentials, generate JWT tokens
- **Integration Point**: Before all endpoint executions
- **Protocol**: HTTP REST or gRPC
- **Timeout**: 2 seconds
- **Retry**: 2 retries with 1s backoff
- **Failure Behavior**: Return 401 Unauthorized

**2. Email Notification Service**
- **Purpose**: Send emails for task reminders, user registration
- **Integration Point**: After task creation, user creation
- **Protocol**: SMTP or HTTP REST
- **Timeout**: 10 seconds
- **Retry**: 3 retries with exponential backoff
- **Failure Behavior**: Log error, continue (non-blocking)

**3. Analytics/Logging Service**
- **Purpose**: Track user actions, API metrics
- **Integration Point**: After each request
- **Protocol**: HTTP POST or Message Queue
- **Timeout**: 5 seconds
- **Retry**: 1 retry
- **Failure Behavior**: Log locally, continue (non-blocking)

**4. Database Service** (if migrated from in-memory)
- **Purpose**: Persistent data storage
- **Integration Point**: All CRUD operations
- **Protocol**: PostgreSQL wire protocol or REST
- **Timeout**: 5 seconds
- **Retry**: 2 retries
- **Failure Behavior**: Return 503 Service Unavailable

### 4.5 Integration Patterns & Best Practices

#### 4.5.1 Synchronous vs Asynchronous

**Current Implementation**: Synchronous (all operations block until complete)

**Recommended for Future**:
- **Synchronous**: CRUD operations (user/task management)
- **Asynchronous**: Email notifications, analytics logging

#### 4.5.2 Timeout Configuration

**Recommended Timeouts**:
```python
UPSTREAM_REQUEST_TIMEOUT = 30000  # 30 seconds (client → this API)
DOWNSTREAM_DB_TIMEOUT = 5000      # 5 seconds (this API → database)
DOWNSTREAM_EMAIL_TIMEOUT = 10000  # 10 seconds (this API → email service)
DOWNSTREAM_AUTH_TIMEOUT = 2000    # 2 seconds (this API → auth service)
```

**Current Implementation**: No explicit timeouts configured

#### 4.5.3 Retry Strategy

**Recommended Retry Policy**:
```
- Transient Errors: Retry with exponential backoff
- Permanent Errors: No retry (400, 404, 422)
- Server Errors: Retry 3 times (500, 502, 503, 504)
- Network Errors: Retry 3 times with backoff
```

**Current Implementation**: No retry mechanism

#### 4.5.4 Circuit Breaker Pattern

**Recommended Configuration**:
```
- Failure Threshold: 5 consecutive failures
- Timeout: 30 seconds
- Half-Open State: Test with 1 request
- Success Threshold: 2 consecutive successes to close
```

**Current Implementation**: Not implemented

### 4.6 Error Handling in Integrations

#### 4.6.1 Upstream Error Handling (Client Errors)

**This API's Responsibilities**:
1. Validate all incoming requests
2. Return appropriate HTTP status codes
3. Provide detailed error messages in JSON
4. Log all errors for debugging

**Error Response Format**:
```json
{
    "detail": "Error message",
    "error_code": "ERR_001",        // Not implemented
    "timestamp": "2025-11-03T...",   // Not implemented
    "path": "/users/123"             // Not implemented
}
```

#### 4.6.2 Downstream Error Handling (Service Failures)

**If Database Service Fails**:
```
1. Catch database connection error
2. Log error with correlation ID
3. Return 503 Service Unavailable
4. Response: {"detail": "Service temporarily unavailable"}
5. Trigger alert to operations team
```

**If Email Service Fails**:
```
1. Catch email send error
2. Log error (non-blocking)
3. Continue with main operation (user/task creation succeeds)
4. Queue email for retry (if queue exists)
5. Return success to client (email failure is not critical)
```

**If Authentication Service Fails**:
```
1. Catch auth service timeout
2. Log error with request details
3. Return 503 Service Unavailable
4. Response: {"detail": "Authentication service unavailable"}
5. Client should retry after delay
```

### 4.7 Integration Failure Scenarios & Behavior

#### 4.7.1 Scenario: Database Connection Lost

**Trigger**: Database service becomes unavailable mid-operation

**Expected Behavior**:
```
1. Active request fails immediately
2. API returns 503 Service Unavailable
3. Subsequent requests fail fast (no retry to dead service)
4. Health check endpoint reports degraded
5. Circuit breaker opens after 5 failures
6. Auto-recovery when database returns
```

**Current Behavior**: N/A (in-memory database, no external connection)

#### 4.7.2 Scenario: Downstream Service Timeout

**Trigger**: Email service takes >10 seconds to respond

**Expected Behavior**:
```
1. Request times out after 10 seconds
2. Log timeout error
3. Email marked as failed in queue
4. Main operation (e.g., user creation) succeeds
5. Return success to client
6. Background job retries email later
```

**Current Behavior**: N/A (no downstream services)

#### 4.7.3 Scenario: Partial System Failure

**Trigger**: Authentication service down, but database available

**Expected Behavior**:
```
1. Health check reports degraded (auth down)
2. Authenticated endpoints return 503
3. Public endpoints (if any) continue to work
4. Circuit breaker isolates failed service
5. Monitoring alerts triggered
6. Auto-recovery when auth service restored
```

**Current Behavior**: N/A (no authentication service)

#### 4.7.4 Scenario: Cascading Failure

**Trigger**: Slow database causes request queue buildup

**Expected Behavior**:
```
1. Requests start queuing
2. Thread pool fills up
3. New requests fail fast (503)
4. Load balancer detects unhealthy instance
5. Traffic redirected to healthy instances
6. Auto-scaling triggered (if configured)
```

**Current Behavior**: Requests queue indefinitely (no protection)

#### 4.7.5 Scenario: Data Inconsistency

**Trigger**: Task created but notification fails

**Expected Behavior**:
```
1. Task creation transaction commits
2. Notification send fails
3. Log inconsistency
4. Background job detects missing notification
5. Retry notification
6. User receives delayed notification
```

**Current Behavior**: N/A (no notifications)

### 4.8 Integration Testing Requirements

#### 4.8.1 Upstream Integration Tests

**Test Scenarios**:
1. Valid client requests from different sources
2. CORS preflight requests (if configured)
3. Large payload handling (boundary testing)
4. Concurrent requests from multiple clients
5. Client timeout scenarios
6. Malformed request handling

#### 4.8.2 Downstream Integration Tests

**Test Scenarios** (for future):
1. Downstream service unavailable
2. Downstream service slow response
3. Downstream service returning errors
4. Network partition scenarios
5. Retry mechanism validation
6. Circuit breaker state transitions

#### 4.8.3 Contract Testing

**Recommended Approach**:
- Use OpenAPI spec for contract validation
- Implement consumer-driven contract tests (Pact)
- Version API to prevent breaking changes
- Validate request/response schemas

**Current State**: OpenAPI spec available at `/openapi.json`

### 4.9 Integration Monitoring & Observability

#### 4.9.1 Recommended Metrics

**Upstream Metrics** (Client → This API):
- Request rate (requests/second)
- Response time (p50, p95, p99)
- Error rate by status code
- Request payload size
- Active connections

**Downstream Metrics** (This API → Services):
- Downstream call rate
- Downstream response time
- Downstream error rate
- Circuit breaker state
- Retry count

**Current Implementation**: ❌ No metrics collection

#### 4.9.2 Recommended Logging

**Integration Logs Should Include**:
```json
{
    "timestamp": "2025-11-03T18:45:00",
    "correlation_id": "abc-123",
    "request_id": "req-456",
    "source": "web-app",
    "endpoint": "/users",
    "method": "POST",
    "status_code": 201,
    "duration_ms": 45,
    "downstream_calls": [
        {"service": "email", "duration_ms": 120, "status": "success"}
    ]
}
```

**Current Implementation**: Basic request/response logs in `api.log`

#### 4.9.3 Health Check Endpoints

**Recommended Implementation**:
```
GET /health
Response: {
    "status": "healthy|degraded|unhealthy",
    "version": "1.0.0",
    "uptime": 3600,
    "dependencies": {
        "database": "healthy",
        "email_service": "unhealthy"
    }
}
```

**Current Implementation**: ❌ Not implemented

### 4.10 Integration Security

#### 4.10.1 API Gateway Pattern (Recommended)

```
Client → API Gateway → This API → Downstream Services
         ↓
    - Authentication
    - Rate Limiting
    - Request Validation
    - Response Caching
```

**Current State**: Direct client access (no gateway)

#### 4.10.2 Service-to-Service Authentication

**Recommended**: mTLS or JWT tokens for downstream calls

**Current State**: N/A (no downstream services)

#### 4.10.3 Secure Communication

**Recommended**:
- HTTPS for all client communication
- mTLS for service-to-service
- API keys for external integrations
- IP whitelisting for internal services

**Current State**: HTTP only (no encryption)

### 4.11 Integration Configuration

#### 4.11.1 Environment-Based Configuration

**Recommended Structure**:
```python
# config.py
class IntegrationConfig:
    # Upstream
    CORS_ORIGINS = os.getenv("CORS_ORIGINS", "*")
    API_GATEWAY_URL = os.getenv("API_GATEWAY_URL")

    # Downstream
    DATABASE_URL = os.getenv("DATABASE_URL")
    EMAIL_SERVICE_URL = os.getenv("EMAIL_SERVICE_URL")
    AUTH_SERVICE_URL = os.getenv("AUTH_SERVICE_URL")

    # Timeouts
    REQUEST_TIMEOUT = int(os.getenv("REQUEST_TIMEOUT", "30"))
    DB_TIMEOUT = int(os.getenv("DB_TIMEOUT", "5"))

    # Retry
    MAX_RETRIES = int(os.getenv("MAX_RETRIES", "3"))
    RETRY_BACKOFF = int(os.getenv("RETRY_BACKOFF", "1"))
```

**Current State**: Hardcoded configuration in code

### 4.12 Integration Requirements Summary

**INT-REQ-001**: API shall accept HTTP/JSON requests on port 8000
**INT-REQ-002**: API shall validate all incoming requests using Pydantic
**INT-REQ-003**: API shall return JSON responses with appropriate HTTP status codes
**INT-REQ-004**: API shall implement timeout handling for all operations (future)
**INT-REQ-005**: API shall implement retry logic for transient failures (future)
**INT-REQ-006**: API shall implement circuit breaker for downstream services (future)
**INT-REQ-007**: API shall log all integration errors with correlation IDs (future)
**INT-REQ-008**: API shall provide health check endpoint for monitoring (future)
**INT-REQ-009**: API shall support CORS for web client access (future)
**INT-REQ-010**: API shall implement graceful degradation when downstream services fail (future)

---

## 5. DATABASE SPECIFICATION

### 4.1 Database Type
**Type**: In-Memory Storage
**Implementation**: Python List of Dictionaries
**Persistence**: None (data lost on server restart)
**Location**: `models.py` file

### 4.2 Database Structure

#### 4.2.1 Users Database (`users_db`)

**Variable Name**: `users_db`
**File**: `/Users/qrish/api/models.py` (line 2)
**Type**: `List[Dict]`

**Schema**:
```python
{
    "id": int,        # Primary Key, unique, auto-increment
    "name": str,      # User's full name, required
    "email": str      # User's email, required, unique, email format
}
```

**Initial Data** (2 records):
```python
[
    {"id": 1, "name": "John Doe", "email": "john@example.com"},
    {"id": 2, "name": "Jane Smith", "email": "jane@example.com"}
]
```

**Constraints**:
- `id`: Unique, auto-generated (max existing id + 1)
- `email`: Must be unique across all users
- `email`: Must be valid email format (validated by Pydantic)
- `name`: Required, string, no length limits
- `email`: Required, string

**Indexes**: None (linear search used)

#### 4.2.2 Tasks Database (`tasks_db`)

**Variable Name**: `tasks_db`
**File**: `/Users/qrish/api/models.py` (line 7)
**Type**: `List[Dict]`

**Schema**:
```python
{
    "id": int,              # Primary Key, unique, auto-increment
    "user_id": int,         # Foreign Key to users_db.id
    "title": str,           # Task title, required
    "description": str,     # Task description, optional (can be None)
    "status": str,          # Task status: "pending" or "completed"
    "created_at": str,      # ISO 8601 datetime string, auto-set
    "updated_at": str,      # ISO 8601 datetime string, auto-updated
    "due_date": str | None  # ISO 8601 datetime string or None
}
```

**Initial Data** (3 records):
```python
[
    {
        "id": 1,
        "user_id": 1,
        "title": "Complete project documentation",
        "description": "Write comprehensive API documentation",
        "status": "pending",
        "created_at": "2025-01-15T10:00:00",
        "updated_at": "2025-01-15T10:00:00",
        "due_date": "2025-01-20T23:59:59"
    },
    {
        "id": 2,
        "user_id": 1,
        "title": "Review pull requests",
        "description": "Review and merge pending PRs",
        "status": "completed",
        "created_at": "2025-01-14T09:00:00",
        "updated_at": "2025-01-15T14:30:00",
        "due_date": None
    },
    {
        "id": 3,
        "user_id": 2,
        "title": "Prepare presentation",
        "description": "Create slides for team meeting",
        "status": "pending",
        "created_at": "2025-01-15T11:00:00",
        "updated_at": "2025-01-15T11:00:00",
        "due_date": "2025-01-18T15:00:00"
    }
]
```

**Constraints**:
- `id`: Unique, auto-generated (max existing id + 1)
- `user_id`: Must reference existing user (validated on task creation/access)
- `title`: Required, string
- `status`: Must be "pending" or "completed" (case-sensitive)
- `created_at`: Auto-set on creation, never modified
- `updated_at`: Auto-set on creation, updated on every modification
- `description`: Optional (can be None)
- `due_date`: Optional (can be None), must be ISO 8601 format if provided

**Indexes**: None (linear search used)

**Foreign Key Behavior**:
- **ON CREATE**: Validates user_id exists (returns 404 if not)
- **ON UPDATE**: Validates user_id exists (returns 404 if not)
- **ON DELETE USER**: No cascade (orphaned tasks remain with invalid user_id)

### 4.3 Relationships

**User → Tasks**: One-to-Many
- One user can have zero or many tasks
- Each task belongs to exactly one user
- Relationship enforced by `user_id` foreign key
- Relationship validated in code (not database-level constraint)

**Entity Relationship Diagram**:
```
┌─────────────────┐         ┌─────────────────────┐
│     users_db    │         │     tasks_db        │
├─────────────────┤         ├─────────────────────┤
│ id (PK)         │◄────────│ id (PK)             │
│ name            │    1:N  │ user_id (FK)        │
│ email (UNIQUE)  │         │ title               │
└─────────────────┘         │ description         │
                            │ status              │
                            │ created_at          │
                            │ updated_at          │
                            │ due_date            │
                            └─────────────────────┘
```

### 4.4 Database Operations

**Supported Operations**:
- **SELECT**: Linear search through list (O(n) complexity)
- **INSERT**: Append to list (O(1) complexity)
- **UPDATE**: Find and modify in-place (O(n) complexity)
- **DELETE**: Find and remove from list (O(n) complexity)

**No Support For**:
- Transactions
- Rollbacks
- Joins (manual iteration required)
- Indexes
- Query optimization
- Concurrent access control

---

## 5. API ENDPOINTS SPECIFICATION

### 5.1 Base URL
```
http://localhost:8000
```

### 5.2 User Management Endpoints

#### 5.2.1 List Users
**Endpoint**: `GET /users`
**Function**: `list_users()` (main.py:29-37)
**Operation ID**: `list_users_users_get`

**Purpose**: Retrieve a paginated list of all users

**Query Parameters**:
| Parameter | Type | Required | Validation | Description |
|-----------|------|----------|------------|-------------|
| limit | integer | No | 1 ≤ value ≤ 100 | Number of users to return |
| offset | integer | No | value ≥ 0 | Number of users to skip |

**Success Response**: 200 OK
```json
[
    {
        "id": 1,
        "name": "John Doe",
        "email": "john@example.com"
    }
]
```

**Error Responses**:
- 422 Unprocessable Entity: Invalid query parameters

**Business Logic**:
- Returns all users if no parameters provided
- Applies offset first, then limit
- Returns empty array if offset exceeds database size
- Query parameters validated by middleware (only limit/offset allowed)

---

#### 5.2.2 Get User by ID
**Endpoint**: `GET /users/{user_id}`
**Function**: `get_user(user_id)` (main.py:40-45)
**Operation ID**: `get_user_users__user_id__get`

**Purpose**: Retrieve a specific user by their unique identifier

**Path Parameters**:
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| user_id | integer | Yes | User's unique identifier |

**Success Response**: 200 OK
```json
{
    "id": 1,
    "name": "John Doe",
    "email": "john@example.com"
}
```

**Error Responses**:
- 404 Not Found: User with specified ID does not exist

**Business Logic**:
- Searches users_db for matching id
- Returns first match (ids are unique)

---

#### 5.2.3 Create User
**Endpoint**: `POST /users`
**Function**: `create_user(new_user)` (main.py:48-58)
**Operation ID**: `create_user_users_post`

**Purpose**: Create a new user in the system

**Request Body** (application/json):
```json
{
    "name": "string",          // Required
    "email": "user@example.com"  // Required, valid email format
}
```

**Success Response**: 201 Created
```json
{
    "id": 3,
    "name": "New User",
    "email": "newuser@example.com"
}
```

**Error Responses**:
- 400 Bad Request: Email already exists
- 422 Unprocessable Entity: Invalid request body (missing fields, invalid email format)

**Business Logic**:
1. Validates email format (Pydantic)
2. Checks for duplicate email (case-sensitive)
3. Generates new ID: max(existing_ids) + 1 (defaults to 1 if empty)
4. Appends new user to users_db
5. Returns created user with assigned ID

---

#### 5.2.4 Update User
**Endpoint**: `PUT /users/{user_id}`
**Function**: `update_user(user_id, update)` (main.py:61-76)
**Operation ID**: `update_user_users__user_id__put`

**Purpose**: Update an existing user's information (partial updates supported)

**Path Parameters**:
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| user_id | integer | Yes | User's unique identifier |

**Request Body** (application/json):
```json
{
    "name": "string",             // Optional
    "email": "user@example.com"   // Optional, valid email format
}
```

**Success Response**: 200 OK
```json
{
    "id": 1,
    "name": "Updated Name",
    "email": "updated@example.com"
}
```

**Error Responses**:
- 404 Not Found: User with specified ID does not exist
- 400 Bad Request: Email already exists (when updating email to duplicate)
- 422 Unprocessable Entity: Invalid request body

**Business Logic**:
1. Validates user exists
2. If email is being updated and differs from current:
   - Checks for duplicate email excluding current user
3. Updates only provided fields (partial update)
4. Returns updated user object

---

#### 5.2.5 Delete User
**Endpoint**: `DELETE /users/{user_id}`
**Function**: `delete_user(user_id)` (main.py:79-85)
**Operation ID**: `delete_user_users__user_id__delete`

**Purpose**: Delete a user from the system

**Path Parameters**:
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| user_id | integer | Yes | User's unique identifier |

**Success Response**: 204 No Content (empty body)

**Error Responses**:
- 404 Not Found: User with specified ID does not exist

**Business Logic**:
1. Searches for user by id
2. Removes user from users_db
3. **Note**: Associated tasks are NOT deleted (orphaned tasks remain)

---

#### 5.2.6 Reset Database
**Endpoint**: `POST /reset-db`
**Function**: `reset_database()` (main.py:89-129)
**Operation ID**: `reset_database_reset_db_post`

**Purpose**: Reset both users and tasks databases to initial seed state (for testing)

**Request Body**: None

**Success Response**: 200 OK
```json
{
    "message": "Database reset successfully"
}
```

**Business Logic**:
1. Clears all users from users_db
2. Restores 2 seed users (John Doe, Jane Smith)
3. Clears all tasks from tasks_db
4. Restores 3 seed tasks
5. Always succeeds (no error conditions)

**Security Note**: Public endpoint with no authentication (potential security risk)

---

### 5.3 Task Management Endpoints

#### 5.3.1 List User Tasks
**Endpoint**: `GET /users/{user_id}/tasks`
**Function**: `list_user_tasks(user_id)` (main.py:134-143)
**Operation ID**: `list_user_tasks_users__user_id__tasks_get`

**Purpose**: Retrieve all tasks belonging to a specific user

**Path Parameters**:
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| user_id | integer | Yes | User's unique identifier |

**Success Response**: 200 OK
```json
[
    {
        "id": 1,
        "user_id": 1,
        "title": "Complete project documentation",
        "description": "Write comprehensive API documentation",
        "status": "pending",
        "created_at": "2025-01-15T10:00:00",
        "updated_at": "2025-01-15T10:00:00",
        "due_date": "2025-01-20T23:59:59"
    }
]
```

**Error Responses**:
- 404 Not Found: User with specified ID does not exist

**Business Logic**:
1. Validates user exists
2. Filters tasks_db for matching user_id
3. Returns empty array if user has no tasks

---

#### 5.3.2 Get Specific Task
**Endpoint**: `GET /users/{user_id}/tasks/{task_id}`
**Function**: `get_user_task(user_id, task_id)` (main.py:146-158)
**Operation ID**: `get_user_task_users__user_id__tasks__task_id__get`

**Purpose**: Retrieve a specific task for a user

**Path Parameters**:
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| user_id | integer | Yes | User's unique identifier |
| task_id | integer | Yes | Task's unique identifier |

**Success Response**: 200 OK
```json
{
    "id": 1,
    "user_id": 1,
    "title": "Complete project documentation",
    "description": "Write comprehensive API documentation",
    "status": "pending",
    "created_at": "2025-01-15T10:00:00",
    "updated_at": "2025-01-15T10:00:00",
    "due_date": "2025-01-20T23:59:59"
}
```

**Error Responses**:
- 404 Not Found: User does not exist
- 404 Not Found: Task does not exist OR task belongs to different user

**Business Logic**:
1. Validates user exists
2. Searches tasks_db for task with matching task_id AND user_id
3. Returns 404 if task exists but belongs to different user (security measure)

---

#### 5.3.3 Create Task
**Endpoint**: `POST /users/{user_id}/tasks`
**Function**: `create_task(user_id, new_task)` (main.py:161-188)
**Operation ID**: `create_task_users__user_id__tasks_post`

**Purpose**: Create a new task for a specific user

**Path Parameters**:
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| user_id | integer | Yes | User's unique identifier |

**Request Body** (application/json):
```json
{
    "title": "string",                        // Required
    "description": "string",                  // Optional
    "status": "pending",                      // Optional, defaults to "pending"
    "due_date": "2025-12-31T23:59:59"        // Optional, ISO 8601 format
}
```

**Success Response**: 201 Created
```json
{
    "id": 4,
    "user_id": 1,
    "title": "New Task",
    "description": "Task description",
    "status": "pending",
    "created_at": "2025-11-03T18:44:55.075633",
    "updated_at": "2025-11-03T18:44:55.075633",
    "due_date": "2025-01-25T17:00:00"
}
```

**Error Responses**:
- 404 Not Found: User does not exist
- 400 Bad Request: Invalid status value (not "pending" or "completed")
- 422 Unprocessable Entity: Invalid request body

**Business Logic**:
1. Validates user exists
2. Validates status is "pending" or "completed" (case-sensitive)
3. Generates new task ID: max(existing_task_ids) + 1
4. Sets created_at and updated_at to current timestamp
5. Sets user_id from URL path parameter
6. Appends task to tasks_db
7. Returns created task

---

#### 5.3.4 Update Task
**Endpoint**: `PUT /users/{user_id}/tasks/{task_id}`
**Function**: `update_task(user_id, task_id, update)` (main.py:191-217)
**Operation ID**: `update_task_users__user_id__tasks__task_id__put`

**Purpose**: Update an existing task (partial updates supported)

**Path Parameters**:
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| user_id | integer | Yes | User's unique identifier |
| task_id | integer | Yes | Task's unique identifier |

**Request Body** (application/json):
```json
{
    "title": "string",                        // Optional
    "description": "string",                  // Optional
    "status": "completed",                    // Optional
    "due_date": "2025-12-31T23:59:59"        // Optional
}
```

**Success Response**: 200 OK
```json
{
    "id": 1,
    "user_id": 1,
    "title": "Updated Task",
    "description": "Updated description",
    "status": "completed",
    "created_at": "2025-01-15T10:00:00",
    "updated_at": "2025-11-03T18:45:07.932034",
    "due_date": "2025-01-20T23:59:59"
}
```

**Error Responses**:
- 404 Not Found: User does not exist
- 404 Not Found: Task does not exist OR belongs to different user
- 400 Bad Request: Invalid status value
- 422 Unprocessable Entity: Invalid request body

**Business Logic**:
1. Validates user exists
2. Validates status if provided (must be "pending" or "completed")
3. Searches for task with matching task_id AND user_id
4. Updates only provided fields (partial update, checks `is not None`)
5. Updates updated_at to current timestamp
6. Returns updated task

---

#### 5.3.5 Delete Task
**Endpoint**: `DELETE /users/{user_id}/tasks/{task_id}`
**Function**: `delete_task(user_id, task_id)` (main.py:220-233)
**Operation ID**: `delete_task_users__user_id__tasks__task_id__delete`

**Purpose**: Delete a specific task

**Path Parameters**:
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| user_id | integer | Yes | User's unique identifier |
| task_id | integer | Yes | Task's unique identifier |

**Success Response**: 204 No Content (empty body)

**Error Responses**:
- 404 Not Found: User does not exist
- 404 Not Found: Task does not exist OR belongs to different user

**Business Logic**:
1. Validates user exists
2. Searches for task with matching task_id AND user_id
3. Removes task from tasks_db
4. Returns 404 if task belongs to different user

---

#### 5.3.6 List All Tasks
**Endpoint**: `GET /tasks`
**Function**: `list_all_tasks(status, limit, offset)` (main.py:236-252)
**Operation ID**: `list_all_tasks_tasks_get`

**Purpose**: Retrieve all tasks across all users with optional filtering and pagination

**Query Parameters**:
| Parameter | Type | Required | Validation | Description |
|-----------|------|----------|------------|-------------|
| status | string | No | "pending" or "completed" | Filter tasks by status |
| limit | integer | No | 1 ≤ value ≤ 100 | Number of tasks to return |
| offset | integer | No | value ≥ 0 | Number of tasks to skip |

**Success Response**: 200 OK
```json
[
    {
        "id": 1,
        "user_id": 1,
        "title": "Complete project documentation",
        "description": "Write comprehensive API documentation",
        "status": "pending",
        "created_at": "2025-01-15T10:00:00",
        "updated_at": "2025-01-15T10:00:00",
        "due_date": "2025-01-20T23:59:59"
    }
]
```

**Error Responses**:
- 400 Bad Request: Invalid status value
- 422 Unprocessable Entity: Invalid query parameters

**Business Logic**:
1. Filters tasks by status if provided (validates status value)
2. Applies pagination (offset then limit)
3. Returns all tasks if no filters
4. Returns empty array if no tasks match filter

---

## 6. BUSINESS LOGIC & RULES

### 6.1 ID Generation

**User ID Generation** (main.py:55):
```python
next_id = max(u["id"] for u in users_db) + 1 if users_db else 1
```
- **Strategy**: Find maximum existing ID and add 1
- **Empty Database**: Starts at 1
- **Not Thread-Safe**: Race condition possible in concurrent environments

**Task ID Generation** (main.py:173):
```python
next_id = max(t["id"] for t in tasks_db) + 1 if tasks_db else 1
```
- **Strategy**: Same as user IDs
- **Independent**: Task IDs independent from user IDs

### 6.2 Email Uniqueness

**On User Creation** (main.py:51-53):
- Iterates through all users
- Case-sensitive comparison
- Returns 400 if duplicate found

**On User Update** (main.py:66-69):
- Only checks if email is being changed
- Excludes current user from duplicate check
- Case-sensitive comparison

**Limitation**: "test@example.com" and "TEST@EXAMPLE.COM" both allowed

### 6.3 Status Validation

**Valid Values**: "pending", "completed"
**Case-Sensitive**: "Pending" or "COMPLETED" rejected
**Default**: "pending" if not provided
**Validation Location**: main.py:169-170, 199-200

### 6.4 User-Task Relationship

**Foreign Key Enforcement**:
- User must exist before creating task (validated at main.py:164-165)
- User must exist to view/update/delete tasks (validated in all task endpoints)
- Task access validated by both task_id AND user_id (security measure)

**Cascade Behavior**:
- Deleting user does NOT delete tasks
- Orphaned tasks remain with invalid user_id
- No referential integrity at database level

### 6.5 Timestamp Management

**created_at**:
- Set automatically on task creation (main.py:176)
- ISO 8601 format with microseconds
- Never modified after creation

**updated_at**:
- Set automatically on task creation (main.py:176)
- Updated automatically on every task modification (main.py:214)
- ISO 8601 format with microseconds

**Timezone**: Local system time, no timezone information included

### 6.6 Partial Update Logic

**User Update** (main.py:71-74):
- Uses truthy check: `if update.name:`
- **Bug**: Empty string ("") won't update (falsy value)

**Task Update** (main.py:205-212):
- Uses None check: `if update.title is not None:`
- **Correct**: Empty string ("") will update

### 6.7 Pagination Logic

**Implementation** (main.py:35-36, 250-251):
```python
start = offset if offset is not None else 0
end = start + limit if limit is not None else len(data)
return data[start:end]
```

**Behavior**:
- Default: Returns all records if no parameters
- Out of bounds offset: Returns empty array
- No metadata: No total count, next/previous links

---

## 7. FUNCTIONAL REQUIREMENTS

### 7.1 User Management Requirements

**FR-UM-001**: System shall support creating users with name and email
**FR-UM-002**: System shall prevent duplicate email addresses (case-sensitive)
**FR-UM-003**: System shall validate email format according to RFC 5322
**FR-UM-004**: System shall auto-generate unique user IDs
**FR-UM-005**: System shall support retrieving user by ID
**FR-UM-006**: System shall support listing all users with pagination
**FR-UM-007**: System shall support partial update of user information
**FR-UM-008**: System shall support deleting users
**FR-UM-009**: System shall support pagination with limit (1-100) and offset (≥0)
**FR-UM-010**: System shall reject query parameters other than limit/offset on GET /users

### 7.2 Task Management Requirements

**FR-TM-001**: System shall support creating tasks associated with users
**FR-TM-002**: System shall prevent creating tasks for non-existent users
**FR-TM-003**: System shall auto-generate unique task IDs
**FR-TM-004**: System shall support task status: "pending" or "completed"
**FR-TM-005**: System shall default task status to "pending" if not specified
**FR-TM-006**: System shall auto-set created_at and updated_at timestamps
**FR-TM-007**: System shall support optional task description and due_date
**FR-TM-008**: System shall support retrieving all tasks for a user
**FR-TM-009**: System shall support retrieving specific task by ID
**FR-TM-010**: System shall prevent cross-user task access
**FR-TM-011**: System shall support partial update of tasks
**FR-TM-012**: System shall update updated_at timestamp on every modification
**FR-TM-013**: System shall support deleting tasks
**FR-TM-014**: System shall support listing all tasks with status filter
**FR-TM-015**: System shall support pagination on task lists

### 7.3 Data Validation Requirements

**FR-DV-001**: System shall validate email format using email-validator library
**FR-DV-002**: System shall validate task status as "pending" or "completed"
**FR-DV-003**: System shall validate due_date as ISO 8601 datetime format
**FR-DV-004**: System shall return 422 for validation errors with detailed messages
**FR-DV-005**: System shall validate required fields (name, email for users; title for tasks)
**FR-DV-006**: System shall validate integer types for IDs
**FR-DV-007**: System shall validate query parameter ranges (limit 1-100, offset ≥0)

### 7.4 API Response Requirements

**FR-AR-001**: System shall return appropriate HTTP status codes (200, 201, 204, 400, 404, 422)
**FR-AR-002**: System shall return JSON response format
**FR-AR-003**: System shall return created resource with 201 status on POST
**FR-AR-004**: System shall return empty body with 204 status on DELETE
**FR-AR-005**: System shall return error message in "detail" field
**FR-AR-006**: System shall return Pydantic validation errors with location information

### 7.5 Database Reset Requirements

**FR-DR-001**: System shall support resetting database to initial state
**FR-DR-002**: Reset shall restore exactly 2 seed users
**FR-DR-003**: Reset shall restore exactly 3 seed tasks
**FR-DR-004**: Reset shall clear all existing data before restoring seeds

---

## 8. PERFORMANCE REQUIREMENTS

### 8.1 Response Time Requirements

**PR-RT-001**: Single user retrieval (GET /users/{id}) shall respond within 100ms
**PR-RT-002**: User list retrieval (GET /users) with <100 users shall respond within 200ms
**PR-RT-003**: Single task retrieval shall respond within 100ms
**PR-RT-004**: Task list retrieval with <1000 tasks shall respond within 500ms
**PR-RT-005**: User creation shall respond within 150ms
**PR-RT-006**: Task creation shall respond within 150ms
**PR-RT-007**: Update operations shall respond within 150ms
**PR-RT-008**: Delete operations shall respond within 100ms
**PR-RT-009**: Database reset shall respond within 200ms

### 8.2 Throughput Requirements

**PR-TH-001**: System shall handle minimum 100 requests per second
**PR-TH-002**: System shall handle 1000 sequential requests without degradation
**PR-TH-003**: Average response time shall remain <200ms under normal load
**PR-TH-004**: 95th percentile response time shall be <500ms

### 8.3 Scalability Requirements

**PR-SC-001**: System shall support up to 10,000 users in database
**PR-SC-002**: System shall support up to 100,000 tasks in database
**PR-SC-003**: Pagination shall maintain performance with large datasets
**PR-SC-004**: Search operations shall complete in O(n) time complexity

### 8.4 Resource Requirements

**PR-RS-001**: System shall run on single CPU core
**PR-RS-002**: System shall consume <512MB memory under normal load
**PR-RS-003**: System shall consume <1GB memory with 10k users and 100k tasks

### 8.5 Current Limitations

**Note**: Current implementation uses in-memory storage with O(n) complexity for searches. Performance will degrade linearly with data growth. Pagination helps but doesn't eliminate linear search cost.

---

## 9. SECURITY REQUIREMENTS

### 9.1 Authentication Requirements

**SR-AU-001**: ❌ NOT IMPLEMENTED - No authentication mechanism exists
**SR-AU-002**: ❌ NOT IMPLEMENTED - All endpoints are publicly accessible
**SR-AU-003**: ❌ NOT IMPLEMENTED - No API keys, tokens, or credentials required

**Current State**: All endpoints are unprotected

### 9.2 Authorization Requirements

**SR-AZ-001**: ❌ NOT IMPLEMENTED - No role-based access control
**SR-AZ-002**: ✅ IMPLEMENTED - Tasks can only be accessed by owning user (via user_id in URL)
**SR-AZ-003**: ❌ NOT IMPLEMENTED - No admin vs user roles
**SR-AZ-004**: ❌ NOT IMPLEMENTED - Reset endpoint publicly accessible

**Current State**: Partial authorization via URL-based user_id validation

### 9.3 Input Validation Requirements

**SR-IV-001**: ✅ IMPLEMENTED - Email format validation using Pydantic
**SR-IV-002**: ✅ IMPLEMENTED - Type validation for all fields
**SR-IV-003**: ✅ IMPLEMENTED - Range validation for pagination parameters
**SR-IV-004**: ❌ NOT IMPLEMENTED - No input sanitization for XSS prevention
**SR-IV-005**: ❌ NOT IMPLEMENTED - No maximum length validation for text fields
**SR-IV-006**: ✅ IMPLEMENTED - Status value whitelist validation

### 9.4 Data Protection Requirements

**SR-DP-001**: ❌ NOT IMPLEMENTED - No data encryption at rest
**SR-DP-002**: ❌ NOT IMPLEMENTED - No data encryption in transit (HTTP not HTTPS)
**SR-DP-003**: ❌ NOT IMPLEMENTED - No password hashing (no passwords exist)
**SR-DP-004**: ❌ NOT IMPLEMENTED - No sensitive data masking in logs
**SR-DP-005**: ✅ IMPLEMENTED - Email stored in plain text (acceptable for demo)

### 9.5 API Security Requirements

**SR-AS-001**: ❌ NOT IMPLEMENTED - No rate limiting
**SR-AS-002**: ❌ NOT IMPLEMENTED - No CORS policy (same-origin only by default)
**SR-AS-003**: ✅ IMPLEMENTED - Appropriate HTTP status codes prevent information leakage
**SR-AS-004**: ❌ NOT IMPLEMENTED - No request size limits
**SR-AS-005**: ❌ NOT IMPLEMENTED - No SQL injection protection (no SQL database)
**SR-AS-006**: ❌ NOT IMPLEMENTED - No XSS protection (stores raw input)

### 9.6 Error Handling Security

**SR-EH-001**: ✅ IMPLEMENTED - Generic error messages (no stack traces)
**SR-EH-002**: ✅ IMPLEMENTED - No internal details exposed in error responses
**SR-EH-003**: ✅ IMPLEMENTED - Consistent 404 for non-existent and unauthorized resources

### 9.7 Audit & Logging Requirements

**SR-AL-001**: ❌ NOT IMPLEMENTED - No audit trail of operations
**SR-AL-002**: ❌ NOT IMPLEMENTED - No user activity logging
**SR-AL-003**: ✅ IMPLEMENTED - Basic request/response logging in api.log
**SR-AL-004**: ❌ NOT IMPLEMENTED - No security event logging

### 9.8 Known Security Vulnerabilities

**CRITICAL**:
1. No authentication - anyone can access all endpoints
2. No authorization - reset endpoint publicly accessible
3. No rate limiting - vulnerable to DOS attacks
4. HTTP only - no encryption in transit
5. No input sanitization - XSS payloads stored as-is

**MEDIUM**:
6. No CORS policy - restricts legitimate cross-origin use
7. No audit logging - no accountability
8. Orphaned tasks on user deletion - potential data leak

**LOW**:
9. Case-sensitive email uniqueness - could allow duplicates
10. No maximum field lengths - potential memory exhaustion

---

## 10. DATABASE BACKUP, RESTORE & DR REQUIREMENTS

### 10.1 Backup Requirements

**DR-BK-001**: ❌ NOT APPLICABLE - No persistent storage (in-memory only)
**DR-BK-002**: ❌ NOT IMPLEMENTED - No automated backup mechanism
**DR-BK-003**: ❌ NOT IMPLEMENTED - No manual backup capability
**DR-BK-004**: ❌ NOT IMPLEMENTED - No backup retention policy

**Current State**: All data lost on server restart. No backup mechanism exists.

### 10.2 Restore Requirements

**DR-RS-001**: ✅ IMPLEMENTED - Manual restore via POST /reset-db endpoint
**DR-RS-002**: ✅ IMPLEMENTED - Restores to predefined seed data
**DR-RS-003**: ❌ NOT IMPLEMENTED - Cannot restore to arbitrary previous state
**DR-RS-004**: ❌ NOT IMPLEMENTED - No point-in-time recovery

**Current Capability**: Can only reset to initial seed data (2 users, 3 tasks)

### 10.3 Disaster Recovery Requirements

**DR-DR-001**: ❌ NOT IMPLEMENTED - No disaster recovery plan
**DR-DR-002**: ❌ NOT IMPLEMENTED - No data replication
**DR-DR-003**: ✅ IMPLEMENTED - Fast recovery via server restart + reset-db
**DR-DR-004**: ❌ NOT IMPLEMENTED - No high availability configuration
**DR-DR-005**: ❌ NOT IMPLEMENTED - No failover mechanism

**Recovery Time Objective (RTO)**: <1 minute (restart server + reset database)
**Recovery Point Objective (RPO)**: Infinite (all data lost, restore to seed state)

### 10.4 Data Persistence

**DR-DP-001**: ❌ NOT IMPLEMENTED - No persistent storage backend
**DR-DP-002**: ❌ NOT IMPLEMENTED - No database snapshots
**DR-DP-003**: ❌ NOT IMPLEMENTED - No transaction logs
**DR-DP-004**: ❌ NOT IMPLEMENTED - No write-ahead logging

**Current State**: Completely ephemeral storage. Data exists only in memory.

### 10.5 Migration & Import/Export

**DR-MG-001**: ❌ NOT IMPLEMENTED - No data export capability
**DR-MG-002**: ❌ NOT IMPLEMENTED - No data import capability
**DR-MG-003**: ❌ NOT IMPLEMENTED - No bulk load functionality
**DR-MG-004**: ❌ NOT IMPLEMENTED - No data migration scripts

### 10.6 Recommendations for Production

For production deployment, the following would be required:

1. **Implement Persistent Database**: Replace in-memory storage with PostgreSQL/MySQL
2. **Automated Backups**: Daily full backups + continuous transaction logs
3. **Backup Retention**: Maintain 30 days of daily backups, 12 months of monthly backups
4. **Point-in-Time Recovery**: Ability to restore to any point within retention period
5. **Replication**: Implement master-slave or multi-master replication
6. **High Availability**: Deploy in active-passive or active-active configuration
7. **Monitoring**: Implement backup success/failure monitoring and alerting
8. **Testing**: Regular disaster recovery drills (quarterly recommended)

---

## 11. ERROR HANDLING & STATUS CODES

### 11.1 HTTP Status Codes

| Code | Meaning | Usage |
|------|---------|-------|
| **200 OK** | Success with response body | GET (found), PUT success, POST /reset-db |
| **201 Created** | Resource created | POST /users, POST /tasks |
| **204 No Content** | Success without response body | DELETE success |
| **400 Bad Request** | Business logic violation | Duplicate email, invalid status value |
| **404 Not Found** | Resource not found | User/task doesn't exist, unauthorized access |
| **422 Unprocessable Entity** | Validation error | Invalid request body, invalid query params |

### 11.2 Error Response Format

**Standard Error Response**:
```json
{
    "detail": "Error message"
}
```

**Validation Error Response** (422):
```json
{
    "detail": [
        {
            "loc": ["body", "field_name"],
            "msg": "Human-readable error message",
            "type": "error_type_identifier"
        }
    ]
}
```

### 11.3 Error Messages by Endpoint

**User Endpoints**:
- "User not found" (404)
- "Email already exists" (400)
- "Invalid query parameter(s): {param_names}" (422)

**Task Endpoints**:
- "User not found" (404)
- "Task not found" (404)
- "Status must be 'pending' or 'completed'" (400)

**Validation Errors**:
- "value is not a valid email address" (422)
- "ensure this value is greater than or equal to 1" (422)
- "field required" (422)

### 11.4 Error Handling Strategy

**Validation Layer** (Pydantic):
- Type validation
- Format validation (email, datetime)
- Range validation (limit, offset)
- Required field validation

**Business Logic Layer** (Endpoint functions):
- Resource existence checks
- Business rule validation (duplicate email, valid status)
- Relationship validation (user_id foreign key)

**Middleware Layer**:
- Query parameter whitelist validation (GET /users only)

---

## 12. DATA VALIDATION RULES

### 12.1 User Validation Rules

**Name Field**:
- **Type**: String
- **Required**: Yes
- **Minimum Length**: None (empty string not explicitly rejected)
- **Maximum Length**: None
- **Pattern**: None (any characters allowed)
- **Validation**: Pydantic type check only

**Email Field**:
- **Type**: String
- **Required**: Yes
- **Format**: Valid email per RFC 5322
- **Validation**: Pydantic EmailStr + email-validator library
- **Uniqueness**: Must be unique (case-sensitive)
- **Examples**:
  - ✅ Valid: "user@example.com", "test+tag@domain.co.uk"
  - ❌ Invalid: "invalid", "test@", "@example.com"

### 12.2 Task Validation Rules

**Title Field**:
- **Type**: String
- **Required**: Yes
- **Minimum Length**: None
- **Maximum Length**: None
- **Validation**: Pydantic type check only

**Description Field**:
- **Type**: String or None
- **Required**: No
- **Default**: None
- **Validation**: Pydantic type check only

**Status Field**:
- **Type**: String
- **Required**: No (has default)
- **Default**: "pending"
- **Allowed Values**: "pending", "completed" (case-sensitive)
- **Validation**: Custom business logic (main.py:169-170, 199-200)
- **Examples**:
  - ✅ Valid: "pending", "completed"
  - ❌ Invalid: "Pending", "COMPLETED", "in-progress", null

**Due Date Field**:
- **Type**: ISO 8601 datetime string or None
- **Required**: No
- **Default**: None
- **Format**: YYYY-MM-DDTHH:MM:SS or YYYY-MM-DDTHH:MM:SS.ffffff
- **Validation**: Pydantic datetime parsing
- **Examples**:
  - ✅ Valid: "2025-12-31T23:59:59", "2025-01-15T10:00:00.123456", None
  - ❌ Invalid: "2025-12-31", "12/31/2025", "invalid"

**Timestamps (created_at, updated_at)**:
- **Type**: ISO 8601 datetime string
- **Required**: Yes (auto-generated)
- **Format**: YYYY-MM-DDTHH:MM:SS.ffffff
- **Validation**: Auto-generated, no user input

### 12.3 Query Parameter Validation

**limit**:
- **Type**: Integer
- **Required**: No
- **Minimum**: 1
- **Maximum**: 100
- **Default**: None (returns all)

**offset**:
- **Type**: Integer
- **Required**: No
- **Minimum**: 0
- **Default**: 0

**status** (for GET /tasks):
- **Type**: String
- **Required**: No
- **Allowed Values**: "pending", "completed"
- **Default**: None (no filter)

### 12.4 Path Parameter Validation

**user_id**:
- **Type**: Integer
- **Required**: Yes
- **Validation**: Pydantic type check + existence check in database

**task_id**:
- **Type**: Integer
- **Required**: Yes
- **Validation**: Pydantic type check + existence check in database

---

## 13. OPENAPI SPECIFICATION

### 13.1 OpenAPI Document

**Version**: OpenAPI 3.1.0
**Format**: JSON
**File Location**: `/Users/qrish/api/openapi.json`
**File Size**: 852 lines
**Access URL**: `http://localhost:8000/openapi.json`

### 13.2 API Metadata

```json
{
    "openapi": "3.1.0",
    "info": {
        "title": "User Management API",
        "description": "Sample API for demonstrating agentic API testing",
        "version": "1.0.0"
    }
}
```

### 13.3 Documentation Interfaces

**Swagger UI**:
- **URL**: `http://localhost:8000/docs`
- **Features**: Interactive API testing, schema visualization, example requests

**ReDoc**:
- **URL**: `http://localhost:8000/redoc`
- **Features**: Clean documentation, three-panel layout, better for reading

### 13.4 Schema Definitions

The OpenAPI document includes complete schema definitions for:
- **User**: User response schema with id, name, email
- **UserCreate**: User creation request schema
- **UserUpdate**: User update request schema
- **Task**: Task response schema with all fields
- **TaskCreate**: Task creation request schema
- **TaskUpdate**: Task update request schema
- **HTTPValidationError**: Validation error response
- **ValidationError**: Individual validation error detail

### 13.5 Operation IDs

All endpoints have unique operation IDs for programmatic access:
- `list_users_users_get`
- `get_user_users__user_id__get`
- `create_user_users_post`
- `update_user_users__user_id__put`
- `delete_user_users__user_id__delete`
- `reset_database_reset_db_post`
- `list_user_tasks_users__user_id__tasks_get`
- `get_user_task_users__user_id__tasks__task_id__get`
- `create_task_users__user_id__tasks_post`
- `update_task_users__user_id__tasks__task_id__put`
- `delete_task_users__user_id__tasks__task_id__delete`
- `list_all_tasks_tasks_get`

---

## 14. KNOWN LIMITATIONS

### 14.1 Implementation Limitations

1. **In-Memory Storage Only**
   - All data lost on server restart
   - Not suitable for production use
   - No data persistence across sessions

2. **No Concurrency Control**
   - ID generation not thread-safe
   - Race conditions possible with concurrent requests
   - No locking mechanism

3. **Linear Search Performance**
   - O(n) complexity for all lookups
   - Performance degrades with data growth
   - No indexing or optimization

4. **Case-Sensitive Email Uniqueness**
   - "test@example.com" and "TEST@EXAMPLE.COM" both allowed
   - May lead to duplicate users

5. **Orphaned Tasks on User Deletion**
   - Deleting user doesn't delete tasks
   - Tasks remain with invalid user_id
   - No cascade delete

6. **Partial Update Bug** (User Update)
   - Cannot update name/email to empty string
   - Uses truthy check instead of None check
   - Location: main.py:71-74

### 14.2 Feature Gaps

1. **No Authentication/Authorization**
   - All endpoints publicly accessible
   - No user login or session management
   - No API keys or tokens

2. **No Rate Limiting**
   - Vulnerable to DOS attacks
   - No request throttling

3. **No CORS Configuration**
   - Same-origin policy only
   - Cannot be called from other domains

4. **No Filtering (Users)**
   - Cannot filter users by name or email
   - Only pagination supported

5. **No Sorting**
   - Results always in insertion order
   - No custom sort options

6. **No Bulk Operations**
   - Must create/update/delete one at a time
   - No batch endpoints

7. **No Soft Deletes**
   - Deleted data permanently removed
   - No recovery mechanism

8. **No Pagination Metadata**
   - No total count provided
   - No next/previous page links

### 14.3 Security Limitations

1. No input sanitization (XSS risk)
2. No request size limits (memory exhaustion risk)
3. No audit logging (no accountability)
4. No encryption (HTTP only)
5. Public reset endpoint (data loss risk)

### 14.4 Scalability Limitations

1. Single server, no horizontal scaling
2. In-memory storage limits dataset size
3. No caching layer
4. No connection pooling (not applicable)
5. No load balancing support

---

**END OF FUNCTIONAL SPECIFICATION DOCUMENT**

---

## APPENDIX A: Quick Reference

### Server Management
```bash
# Start server
cd /Users/qrish/api
./start.sh

# Stop server
./stop.sh

# View logs
tail -f api.log

# Check if running
ps aux | grep uvicorn
```

### Key URLs
- **API Base**: http://localhost:8000
- **OpenAPI JSON**: http://localhost:8000/openapi.json
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

### Test Data Reset
```bash
curl -X POST http://localhost:8000/reset-db
```

### Example Requests
```bash
# List users
curl http://localhost:8000/users

# Create user
curl -X POST http://localhost:8000/users \
  -H "Content-Type: application/json" \
  -d '{"name":"Test User","email":"test@example.com"}'

# Create task
curl -X POST http://localhost:8000/users/1/tasks \
  -H "Content-Type: application/json" \
  -d '{"title":"New Task","status":"pending"}'
```

---

## DOCUMENT REVISION HISTORY

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0.0 | 2025-11-03 | System | Initial functional specification |

---

**FOR TESTING AGENT**: This document describes WHAT the system does and HOW it should behave. Use this specification to derive comprehensive test cases covering positive scenarios, negative scenarios, edge cases, integration tests, system tests, regression tests, performance tests, and security tests.
